<!-- <script>
  function isAuthenticated() {
    return localStorage.getItem('authenticated') === 'true';
  }
  if (!isAuthenticated()) {
    // User is not authenticated, redirect to the login page
    window.location.href = 'login.html';
  }
</script> -->
  
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Snacks Point| Dashboard</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="css/food_app.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </head>
  <body class="body-bg">
    <!--Top Navigation-->
    <div class="row" >
      <!--Logo-->
      <div class="col-sm-2 mt-2 center d-none d-sm-block">
          <img src="images/logo2.jpg" alt="Snack Point" class="logo" >
      </div>
      <!--Logo-->
      <div class="col-sm-7 col-10 mt-5">
        <!--Navbar small screen-->
        <button type="button" class="btn btn-md btn-outline-danger dropdown-toggle d-inline d-sm-none" data-bs-toggle="dropdown" aria-expanded="false">
          <i class="fa fa-bars" aria-hidden="true"></i>
        </button>
        <ul class="dropdown-menu form-control d-sm-none">
          <li><a class="dropdown-item inactive" href="dashboard.html"><i class="fa fa-angle-right" aria-hidden="true"></i> Dashboard</a></li>
          <li><a class="dropdown-item inactive" href="#"><i class="fa fa-angle-right" aria-hidden="true"></i> Your Orders</a></li>
          <li><a class="dropdown-item inactive" href="wishlist.html"><i class="fa fa-angle-right" aria-hidden="true"></i> Wishlist</a></li>
          <li><a class="dropdown-item inactive" href="#"><i class="fa fa-angle-right" aria-hidden="true"></i> Services</a></li>
          <li><a class="dropdown-item inactive" href="#"><i class="fa fa-angle-right" aria-hidden="true"></i> Checkout</a></li>
          <li><a class="dropdown-item inactive" href="#"><i class="fa fa-angle-right" aria-hidden="true"></i> About</a></li>
          <li><a class="dropdown-item inactive" href="#"><i class="fa fa-angle-right" aria-hidden="true"></i> Contact</a></li>
        </ul>
        <!--Navbar small screen-->
      
        <button class="btn btn-outline-danger btn-md d-none d-sm-inline"><i class="fa fa-search" aria-hidden="true"></i> Search</button>
        <button class="btn btn-outline-danger btn-md d-none d-sm-inline"><i class="fa fa-tag" aria-hidden="true"></i> Offers</button>
        <a href="#" type="button" class="btn btn-outline-danger btn-md position-relative">
            <i class="fa fa-shopping-cart" aria-hidden="true"></i> Cart
            <span id="countOncart" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"></span>
        </a>
      </div>
      <div class="col-sm-3 col-2 mt-5">
        <div class="btn-group">
          <!--Visible on medium screen-->
          <button type="button" class="btn btn-md btn-outline-danger dropdown-toggle d-none d-sm-inline" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fa fa-user" aria-hidden="true"></i>
            <span id="uname" class="d-none d-sm-inline">Dexter Vin Catolos</span>
          </button>
          <!--Visible on medium screen-->
          <!--Visible on small screen-->
          <button type="button" class="btn btn-md btn-outline-danger dropdown-toggle d-inline d-sm-none" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fa fa-user" aria-hidden="true"></i>
          </button>
          <!--Visible on small screen-->
          <ul class="dropdown-menu form-control">
            <li><a class="dropdown-item" href="#">Profile</a></li>
            <li><a class="dropdown-item" href="#">Settings</a></li>
            <li><a class="dropdown-item" href="logout.html">Logout</a></li>
          </ul>
        </div>
      </div>
      <!--Search bar on small screen--> 
      <div  class=" m-2 col-12  d-block d-sm-none">
        <input class="form-control" type="text" placeholder="Search">
      </div>
        <!--Search bar on small screen--> 
      </div>
      <!--Top Navigation--> 
      <!-- content -->
      <div class="container-fluid">
        <div class="row">
          <!-- Navbar Hidden on small screen-->
          <div class="col-md-2 d-none d-sm-block" >
            <ul class="nav flex-column">
              <li class="nav-item">
                  <a class="nav-link inactive" href="dashboard.html" ><p> <i class="fa fa-angle-right" aria-hidden="true"></i> Dashbord</p></a>
              </li>
              <li class="nav-item">
                  <a class="nav-link inactive" href="#"><p> <i class="fa fa-angle-right" aria-hidden="true"></i> Your Orders</p></a>
              </li>
              <li class="nav-item">
                  <a class="nav-link inactive" href="wishlist.html">
                    <p> 
                      <i class="fa fa-angle-right" aria-hidden="true"></i> 
                      Wishlist
                      <span class="badge bg-danger" style="font-size: 11px;">3</span>
                    </p>
                  </a>
              </li>
              <li class="nav-item">
                  <a class="nav-link inactive" href="#"><p> <i class="fa fa-angle-right" aria-hidden="true"></i> Services</p></a>
              </li>
              <li class="nav-item">
                  <a class="nav-link inactive" href="#"><p> <i class="fa fa-angle-right" aria-hidden="true"></i> Checkout</p></a>
              </li>
              <li class="nav-item">
                  <a class="nav-link inactive" href="#"><p> <i class="fa fa-angle-right" aria-hidden="true"></i> About</p></a>
              </li>
              <li class="nav-item">
                  <a class="nav-link inactive" href="#"><p> <i class="fa fa-angle-right" aria-hidden="true"></i> Contact</p></a>
              </li>
            </ul>
          </div>
          <!-- Navbar Hidden on small screen-->
          <!-- Product list -->
          <div class="row col-sm-7 overflow-auto"   style="background-color: aliceblue; text-align: center; padding:50px;">
            <div class="col-md-12"> <h3>Items on Cart</h3></div>
            <div id="cartitems" class="row d-flex"> 
              <!-- Products on cart will be dynamically displayed here -->
            </div>
            <!-- Product Checkout-->
            <div style="text-align: right;">
              <h3 id="total" class="text-danger">$ 00.00</h3>
              <input type="hidden" id="amountTopay" readonly value="0">
              <button id="checkoutSelectedItem" class="btn btn-md btn-danger form-control disabled" onclick="checkoutSelectedItem()" ><i class="fa fa-money" aria-hidden="true"></i> Checkout</button>
            </div>
            <!-- Product Checkout-->     
          </div>    
          <!-- Product list -->
          <!-- Related Products -->
          <div class="col-sm-3 d-none d-sm-block"  style="padding-left: 50px;">
            <h5>Related products</h5>
            <div class="col-12 product_ads d-flex align-items-center justify-content-center">
              <img src="images/pizza-commercial.gif" alt="">
            </div>        
              <ul id="categoryList" class="nav flex-column">
                <li class="nav-item">
                    <a href="#" class="nav-category">
                      <div class="col-md-6 product_on_cart d-flex align-items-center justify-content-center">
                        <img src="images/b1.jpg">
                      </div>
                      <h6 class="category_name">Stromboli bread</h6>
                    </a>
                </li>
                <li class="nav-item">
                  <a href="#" class="nav-category">
                    <div class="col-md-6 product_on_cart d-flex align-items-center justify-content-center">
                      <img src="images/p1.jpg">
                    </div>
                    <h6 class="category_name">Vegetarian Pizza</h6>
                  </a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-category">
                  <div class="col-md-6 product_on_cart d-flex align-items-center justify-content-center">
                    <img src="images/d9.jpg">
                  </div>
                  <h6 class="category_name">Ice Tea</h6>
                </a>
            </li>
            
                
              </ul>
          </div>
          <!-- Related Products -->
        </div>
      </div>
      <!-- content -->
  </body>
  <script>
  
    //display name of current logged in user---------------------------------------------------------------------------
    let logged_in_user = localStorage.getItem('username');
    document.getElementById("uname").innerHTML =logged_in_user;
    //display name of current logged in user---------------------------------------------------------------------------

    //Function CheckCart---------------------------------------------------------------------------
    function checkCart(){

      let productOncart = JSON.parse(localStorage.getItem('itemOncart'));
      let totalQuantity = 0;

      // Count products added to cart and display total to UI
      if (productOncart !== null) {
        productOncart.items.forEach(item => {
          totalQuantity += item.quantity;
        });
        document.getElementById("countOncart").innerHTML =totalQuantity;
      }else{
        document.getElementById("countOncart").innerHTML ='';
      }
  
    }
    //Function CheckCart---------------------------------------------------------------------------
    //Display products added to cart---------------------------------------------------------------
    function displayCartItems() {

      let productOncart = JSON.parse(localStorage.getItem('itemOncart'));

      let cartDiv = document.getElementById('cartitems');

      cartDiv.innerHTML = '';

      // Create elements for each item and populate the data
      if (productOncart && productOncart.items) {

        for (let item of productOncart.items) {

          let { productid, category,image, name, price, rating,quantity } = item;

          let row = document.createElement('div');
          row.classList.add("col-sm-12","d-flex");
          //check for checkout icon
          let divcheckoutIcon = document.createElement('div');
          divcheckoutIcon.classList.add("col-md-1", "d-flex", "align-items-center", "justify-content-center");
          row.appendChild(divcheckoutIcon);
          
          let checkoutIcon = document.createElement('h3');
          checkoutIcon.setAttribute("id", 'checkout'+category+productid);
          checkoutIcon.innerHTML = '<i class="fa fa-circle-thin text-success"></i>';
          checkoutIcon.onclick = function() {
            checkout(this.id,quantity,price,'check');
          };
          divcheckoutIcon.appendChild(checkoutIcon);
          //product image
          let divImage = document.createElement('div');
          divImage.classList.add("col-md-6" , "product_on_cart","d-flex", "align-items-center", "justify-content-center");
          
          let img = document.createElement('img');
          img.src = image; // Replace 'image_url_here' with the actual image URL
          divImage.appendChild(img);
          row.appendChild(divImage);
          //product details
          let divProductInfo = document.createElement('div');
          divProductInfo.classList.add("col-md-5");

          let tblProductInfo = document.createElement('table');
          tblProductInfo.style.margin="10px";

          let trProductname = document.createElement('tr');

          let thProductname = document.createElement('th');
          thProductname.classList.add("text-success");
          thProductname.innerHTML =  name;

          trProductname.appendChild(thProductname);
          tblProductInfo.appendChild(trProductname);

          let trProductprice = document.createElement('tr');

          let tdProductprice = document.createElement('td');
          tdProductprice.innerHTML = '$'+ price;

          trProductprice.appendChild(tdProductprice);
          tblProductInfo.appendChild(trProductprice);

          let trProductQuantity = document.createElement('tr');
          let tdProductQuantity = document.createElement('td');
          let pProductQuantity = document.createElement('p');

          let iconRemoveproduct = document.createElement('i');
          iconRemoveproduct.classList.add("fa", "fa-minus");
          iconRemoveproduct.setAttribute("id", "minus"+category+productid);
          iconRemoveproduct.onclick = function() {
            removeProduct(this.id,productid,category);
          };

          let iconAddproduct = document.createElement('i');
          iconAddproduct.classList.add("fa", "fa-plus");
          iconAddproduct.setAttribute("id", "plus" + category+productid);
          iconAddproduct.onclick = function() {
            addProduct(this.id,productid,category);
          };

          let spanproductQuantity = document.createElement('span');
          spanproductQuantity.setAttribute("id", 'quantity'+category+productid);
          spanproductQuantity.innerHTML = quantity;
      
          pProductQuantity.appendChild(iconRemoveproduct);
          pProductQuantity.appendChild(spanproductQuantity);
          pProductQuantity.appendChild(iconAddproduct);

          tdProductQuantity.appendChild(pProductQuantity);
          trProductQuantity.appendChild(tdProductQuantity);
          tblProductInfo.appendChild(trProductQuantity);

          let hr = document.createElement('hr');          

          divProductInfo.appendChild(tblProductInfo);
          row.appendChild(divProductInfo);
          cartDiv.appendChild(row);
          cartDiv.appendChild(hr);
          
        }
      }
    }
    //Display products added to cart---------------------------------------------------------------
    // checkout function---------------------------------------------------------------------------
    function checkout(productid,quantity,price,status) {

      let h3 = document.getElementById(productid);

      let amountTopay = parseFloat(document.getElementById("amountTopay").value); 

      let forCheckoutTotal = 0;

      if (status === "check") {
        // if icon is checked
        h3.onclick = function () {
          checkout(this.id,quantity,price,'uncheck');
        };
        document.getElementById(productid).innerHTML = '<i class="fa fa-check-circle text-success"></i>';
        //Add to total amount to pay
        forCheckoutTotal = (price * quantity)+ amountTopay;

        document.getElementById("amountTopay").value = forCheckoutTotal.toFixed(2);
        document.getElementById("total").innerHTML = '$ ' +forCheckoutTotal.toFixed(2);

      } else if (status === "uncheck") {
        // if icon is unchecked
        h3.onclick = function () {
          checkout(this.id,quantity,price,'check');
        };

        document.getElementById(productid).innerHTML = '<i class="fa fa-circle-thin text-success"></i>';

        amountTopay = parseFloat(document.getElementById("amountTopay").value); 
        //Subtract to total amount to pay
        let forCheckoutTotal = amountTopay - (price * quantity) ;

        document.getElementById("amountTopay").value = forCheckoutTotal.toFixed(2);
        document.getElementById("total").innerHTML = '$ '+forCheckoutTotal.toFixed(2);
      }
      
    }
    // checkout function---------------------------------------------------------------------------
    // Add Quantity--------------------------------------------------------------------------------
    function addProduct(id,productid,category){
      let pid = productid;
      let pcategory = category;

      let productOncart = JSON.parse(localStorage.getItem('itemOncart'));

      let productItem = { productid: pid, category: pcategory};

      // Check if a similar object already exists
      let similarObjectIndex = productOncart.items.findIndex(item => {
        return (
          item.productid === pid && item.category === pcategory
        );
      });

      if (similarObjectIndex !== -1) {
        // Similar object exists, update its properties
        productOncart.items[similarObjectIndex].quantity++;
        // Update the corresponding object in localStorage
        localStorage.setItem('itemOncart', JSON.stringify(productOncart));

        displayCartItems();
      }    
    }
    // Add Quantity--------------------------------------------------------------------------------
    //Remove/subtract Quantity--------------------------------------------------------------------------------
    function removeProduct(id, productid, category) {

      let pid = productid;
      let pcategory = category;
      let productOncart = JSON.parse(localStorage.getItem('itemOncart'));

      let productItem = { productid: pid, category: pcategory };

      // Check if a similar object already exists
      let similarObjectIndex = productOncart.items.findIndex(item => {
        return (
          item.productid === pid && item.category === pcategory
        );
      });

      if (similarObjectIndex !== -1) {
        
        productOncart.items[similarObjectIndex].quantity--;
        // Update the corresponding object in localStorage
        localStorage.setItem('itemOncart', JSON.stringify(productOncart));

        displayCartItems();

        // Remove the item if the quantity is zero
        if (productOncart.items[similarObjectIndex].quantity === 0) {
          productOncart.items.splice(similarObjectIndex, 1);
          // Update the corresponding object in localStorage
          localStorage.setItem('itemOncart', JSON.stringify(productOncart));

          displayCartItems();
        }
        checkCart();
      }
    }
    //Remove/subtract Quantity--------------------------------------------------------------------------------

    checkCart();
    displayCartItems();
  </script>
</html>
  